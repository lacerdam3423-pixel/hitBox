local Players=game:GetService("Players")
local LocalPlayer=Players.LocalPlayer
local Camera=workspace.CurrentCamera

local ESP_MASTER=true
local TEAM_CHECK=false
local SHOW_NAME=true
local SHOW_HP=true
local SHOW_DIST=true
local HITBOX_ON=true

local COLOR_MODE=Color3.fromRGB(255,0,0)
local RAINBOW=false
local hue=0

local gui=Instance.new("ScreenGui",game.CoreGui)
gui.Name="GodHitboxESP"
gui.ResetOnSpawn=false

local main=Instance.new("Frame",gui)
main.Size=UDim2.new(0,330,0,390)
main.Position=UDim2.new(0.35,0,0.2,0)
main.BackgroundColor3=Color3.fromRGB(18,18,18)
main.Active=true
main.Draggable=true
main.BorderSizePixel=0
Instance.new("UICorner",main).CornerRadius=UDim.new(0,12)

local title=Instance.new("TextLabel",main)
title.Size=UDim2.new(1,0,0,28)
title.BackgroundTransparency=1
title.Text="GOD HITBOX ESP"
title.Font=Enum.Font.GothamBold
title.TextSize=13
title.TextColor3=Color3.new(1,1,1)

local function btn(txt,y)
	local b=Instance.new("TextButton",main)
	b.Size=UDim2.new(0.9,0,0,24)
	b.Position=UDim2.new(0.05,0,0,y)
	b.Text=txt
	b.Font=Enum.Font.GothamBold
	b.TextSize=10
	b.BackgroundColor3=Color3.fromRGB(35,35,35)
	b.TextColor3=Color3.new(1,1,1)
	b.BorderSizePixel=0
	Instance.new("UICorner",b).CornerRadius=UDim.new(0,6)
	return b
end

local espBtn=btn("ESP: ON",35)
local teamBtn=btn("TEAM: OFF",62)
local nameBtn=btn("NOME: ON",89)
local hpBtn=btn("VIDA: ON",116)
local distBtn=btn("DIST: ON",143)
local hitBtn=btn("HITBOX: ON",170)
local colorTab=btn("CORES ▸",197)
local minBtn=btn("MINIMIZAR",355)

-- Aba cores
local colorsFrame=Instance.new("Frame",main)
colorsFrame.Size=UDim2.new(0.9,0,0,120)
colorsFrame.Position=UDim2.new(0.05,0,0,225)
colorsFrame.BackgroundTransparency=1
colorsFrame.Visible=false

local function cbtn(t,x,y,c)
	local b=Instance.new("TextButton",colorsFrame)
	b.Size=UDim2.new(0,80,0,20)
	b.Position=UDim2.new(0,x,0,y)
	b.Text=t
	b.Font=Enum.Font.GothamBold
	b.TextSize=9
	b.BackgroundColor3=c
	b.TextColor3=Color3.new(0,0,0)
	b.BorderSizePixel=0
	Instance.new("UICorner",b).CornerRadius=UDim.new(0,5)
	return b
end

local red=cbtn("VERM",0,0,Color3.fromRGB(255,0,0))
local yellow=cbtn("AMAR",90,0,Color3.fromRGB(255,255,0))
local green=cbtn("VERD",180,0,Color3.fromRGB(0,255,0))
local blue=cbtn("AZUL",0,25,Color3.fromRGB(0,120,255))
local dark=cbtn("AZ ESC",90,25,Color3.fromRGB(0,0,120))
local black=cbtn("PRETO",180,25,Color3.fromRGB(0,0,0))
local white=cbtn("BRANCO",0,50,Color3.fromRGB(255,255,255))
local rain=cbtn("RAIN",90,50,Color3.fromRGB(255,0,255))

-- Botão reabrir
local reopen=Instance.new("TextButton",gui)
reopen.Size=UDim2.new(0,45,0,45)
reopen.Position=UDim2.new(0,10,0.5,0)
reopen.Text="ESP"
reopen.Visible=false
reopen.Font=Enum.Font.GothamBold
reopen.TextSize=10
reopen.BackgroundColor3=Color3.fromRGB(20,20,20)
reopen.TextColor3=Color3.new(1,1,1)
reopen.BorderSizePixel=0
reopen.Active=true
reopen.Draggable=true
Instance.new("UICorner",reopen).CornerRadius=UDim.new(1,0)

-- Cache
local ESP_CACHE={}

local function createESP(plr)
	if ESP_CACHE[plr] then return end

	local outline=Instance.new("BoxHandleAdornment",gui)
	outline.AlwaysOnTop=true
	outline.Transparency=0.75

	local hitbox=Instance.new("BoxHandleAdornment",gui)
	hitbox.AlwaysOnTop=true
	hitbox.Transparency=0.85

	local bb=Instance.new("BillboardGui",gui)
	bb.Size=UDim2.new(0,160,0,35)
	bb.AlwaysOnTop=true

	local txt=Instance.new("TextLabel",bb)
	txt.Size=UDim2.new(1,0,1,0)
	txt.BackgroundTransparency=1
	txt.Font=Enum.Font.GothamBold
	txt.TextSize=10
	txt.TextStrokeTransparency=0.5

	ESP_CACHE[plr]={outline,hitbox,bb,txt}
end

-- Aviso pequeno
local function notify(t)
	local n=Instance.new("TextLabel",gui)
	n.Size=UDim2.new(0,200,0,22)
	n.Position=UDim2.new(0.5,-100,0.1,0)
	n.BackgroundColor3=Color3.fromRGB(20,20,20)
	n.TextColor3=Color3.new(1,1,1)
	n.Text=t
	n.Font=Enum.Font.GothamBold
	n.TextSize=10
	n.BorderSizePixel=0
	Instance.new("UICorner",n).CornerRadius=UDim.new(0,6)
	task.delay(2,function() if n then n:Destroy() end end)
end

Players.PlayerAdded:Connect(function(p)
	notify("Entrou: "..p.Name)
end)

-- LOOP 0.01
task.spawn(function()
	while true do
		task.wait(0.01)

		if RAINBOW then hue=(hue+0.005)%1 end
		if not ESP_MASTER then continue end

		for _,plr in pairs(Players:GetPlayers()) do
			if plr~=LocalPlayer and plr.Character 
			and plr.Character:FindFirstChild("HumanoidRootPart") 
			and plr.Character:FindFirstChild("Humanoid") then

				createESP(plr)

				local root=plr.Character.HumanoidRootPart
				local hum=plr.Character.Humanoid
				local dist=math.floor((Camera.CFrame.Position-root.Position).Magnitude)
				local hp=math.floor(hum.Health)

				local color
				if RAINBOW then
					color=Color3.fromHSV(hue,1,1)
				elseif TEAM_CHECK and plr.Team then
					color=plr.TeamColor.Color
				else
					color=COLOR_MODE
				end

				local d=ESP_CACHE[plr]
				if d then
					-- outline
					d[1].Adornee=plr.Character
					d[1].Size=Vector3.new(4,6,1)
					d[1].Color3=color

					-- hitbox
					if HITBOX_ON then
						d[2].Adornee=plr.Character
						d[2].Size=Vector3.new(7,9,7)
						d[2].Color3=color
					else
						d[2].Adornee=nil
					end

					-- texto
					d[3].Adornee=plr.Character:FindFirstChild("Head")
					d[3].StudsOffset=Vector3.new(0,2.2,0)

					local t={}
					if SHOW_NAME then table.insert(t,plr.Name) end
					if SHOW_HP then table.insert(t,"HP:"..hp) end
					if SHOW_DIST then table.insert(t,dist.."m") end

					d[4].Text=table.concat(t," | ")
					d[4].TextColor3=color
				end
			end
		end
	end
end)

-- Toggles
espBtn.MouseButton1Click:Connect(function() ESP_MASTER=not ESP_MASTER espBtn.Text=ESP_MASTER and "ESP: ON" or "ESP: OFF" end)
teamBtn.MouseButton1Click:Connect(function() TEAM_CHECK=not TEAM_CHECK teamBtn.Text=TEAM_CHECK and "TEAM: ON" or "TEAM: OFF" end)
nameBtn.MouseButton1Click:Connect(function() SHOW_NAME=not SHOW_NAME nameBtn.Text=SHOW_NAME and "NOME: ON" or "NOME: OFF" end)
hpBtn.MouseButton1Click:Connect(function() SHOW_HP=not SHOW_HP hpBtn.Text=SHOW_HP and "VIDA: ON" or "VIDA: OFF" end)
distBtn.MouseButton1Click:Connect(function() SHOW_DIST=not SHOW_DIST distBtn.Text=SHOW_DIST and "DIST: ON" or "DIST: OFF" end)
hitBtn.MouseButton1Click:Connect(function() HITBOX_ON=not HITBOX_ON hitBtn.Text=HITBOX_ON and "HITBOX: ON" or "HITBOX: OFF" end)

colorTab.MouseButton1Click:Connect(function()
	colorsFrame.Visible=not colorsFrame.Visible
	colorTab.Text=colorsFrame.Visible and "CORES ▾" or "CORES ▸"
end)

minBtn.MouseButton1Click:Connect(function() main.Visible=false reopen.Visible=true end)
reopen.MouseButton1Click:Connect(function() main.Visible=true reopen.Visible=false end)

-- cores
red.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(255,0,0) RAINBOW=false end)
yellow.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(255,255,0) RAINBOW=false end)
green.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(0,255,0) RAINBOW=false end)
blue.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(0,120,255) RAINBOW=false end)
dark.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(0,0,120) RAINBOW=false end)
black.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(0,0,0) RAINBOW=false end)
white.MouseButton1Click:Connect(function() COLOR_MODE=Color3.fromRGB(255,255,255) RAINBOW=false end)
rain.MouseButton1Click:Connect(function() RAINBOW=true end)

-- persistência
LocalPlayer.CharacterAdded:Connect(function()
	task.wait(1)
	gui.Parent=game.CoreGui
end)ggleButton, TweenInfo.new(0.2), {Size = UDim2.new(0.45, -5, 0, 35)}):Play()
    updateHitboxes()
end)

ColorButton.MouseButton1Click:Connect(function()
    currentColor = Color3.fromHSV(math.random(), 0.8, 1)
    ColorButton.BackgroundColor3 = currentColor
end)

RunService.Heartbeat:Connect(updateHitboxes)
dragGUI()
